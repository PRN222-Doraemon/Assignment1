@model IEnumerable<NewsArticle>

@{
	ViewData["Title"] = "News Articles";
	var userId = ViewContext.HttpContext.Session.GetInt32("UserId");
	var userRole = ViewContext.HttpContext.Session.GetInt32("UserRole");
}

@* HTML *@

<div class="container mt-4">
	<h1 class="text-center mb-4">@ViewData["Title"]</h1>
	<div class="d-flex justify-content-between align-items-center mb-3">


		@if (userId != null && userRole == int.Parse(AppCts.Roles.Staff))
		{
			<form asp-action="Index" method="get" asp-controller="NewsArticles" class="d-flex align-items-center">
				<div>
					<label for="filterSelect" class="me-2">Filter:</label>
					<select id="filterSelect" name="filterSelect" class="form-select w-auto d-inline-block" onchange="this.form.submit()">
						<option value="all" selected="@(ViewBag.CurrentFilter == "all" ? "selected" : null)">All Articles</option>
						<option value="mine" selected="@(ViewBag.CurrentFilter == "mine" ? "selected" : null)">My Articles</option>
					</select>
				</div>
			</form>

			<a asp-action="Create" class="btn btn-primary">Create New</a>
		}
	</div>
	<div class="table-responsive">
		<table class="table table-bordered table-striped table-hover align-middle table-lg">
			<thead class="table-primary">
				<tr>
					<th>@Html.DisplayNameFor(model => model.NewsTitle)</th>
					<th>@Html.DisplayNameFor(model => model.Headline)</th>
					<th>@Html.DisplayNameFor(model => model.CreatedDate)</th>
					<th>@Html.DisplayNameFor(model => model.ModifiedDate)</th>
					<th>@Html.DisplayNameFor(model => model.NewsSource)</th>
					<th>@Html.DisplayNameFor(model => model.NewsStatus)</th>
					<th>@Html.DisplayNameFor(model => model.Category)</th>
					<th>@Html.DisplayNameFor(model => model.NewsTags)</th>
					<th>@Html.DisplayNameFor(model => model.CreatedBy)</th>
					<th>Actions</th>
				</tr>
			</thead>
			<tbody>
				@foreach (var item in Model)
				{
					<tr>
						<td>@item.NewsTitle</td>
						<td>@item.Headline</td>
						<td>@item.CreatedDate?.ToString("yyyy-MM-dd")</td>
						<td>@item.ModifiedDate?.ToString("yyyy-MM-dd")</td>
						<td>@item.NewsSource</td>
						<td>
							<span class="badge @((bool)item.NewsStatus ? "bg-success" : "bg-secondary")">
								@((bool)item.NewsStatus ? "Active" : "Inactive")
							</span>
						</td>
						<td>@item.Category?.CategoryName</td>
						<td>
							@if (item.NewsTags != null && item.NewsTags.Any())
							{
								<div class="d-flex flex-wrap gap-1">
									@foreach (var tag in item.NewsTags)
									{
										<span class="badge bg-info text-dark">@tag.Tag.TagName</span>
									}
								</div>
							}
						</td>
						<td>@item.CreatedBy?.AccountName</td>
						<td>
							<a asp-action="Details" asp-route-id="@item.NewsArticleId" class="btn btn-sm btn-warning">
								<i class="fas fa-eye"></i>
							</a>
							@if (userId != null && userRole == int.Parse(AppCts.Roles.Staff))
							{
								<a asp-action="Edit" asp-route-id="@item.NewsArticleId" class="btn btn-sm btn-info text-white">
									<i class="fas fa-edit"></i>
								</a>
								<a asp-action="Delete" asp-route-id="@item.NewsArticleId" class="btn btn-sm btn-danger" onclick="return confirmDelete()">
									<i class="fas fa-trash-alt"></i>
								</a>
							}
						</td>
					</tr>
				}
			</tbody>
		</table>
	</div>
</div>

@* Scripts *@

<script>
	function confirmDelete() {
		return confirm("Are you sure you want to delete this item?");
	}
</script>
